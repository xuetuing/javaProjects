<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0043)http://www.noahweb.net/mail/2/Project_1.htm -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>实现业务系统中的用户权限管理--实现篇</title>
<style type="text/css">
.logicbiaoge {
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	color: #333333;
	background-color: #eeeeee;
	border: 1px solid #333333;
	cellspacing="10";table-layout: fixed;WORD-BREAK: break-all;
}.logicbiaoge1 {	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	color: #333333;
	background-color: #eeeeee;
	border: 1px solid #333333;
	cellspacing="10";table-layout: fixed;WORD-BREAK: break-all;
}
.logicbiaoge2 {	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	color: #333333;
	background-color: #eeeeee;
	border: 1px solid #333333;
	cellspacing="10";table-layout: fixed;WORD-BREAK: break-all;
}
center{
font-size:12px;
}
.style2 {font-family: Arial, Helvetica, sans-serif}
body {
	background-color: #DEE0E6;font-size: 12px;
}
div,strong,p {
	font-size: 12px;
}
</style>

</head>

<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<div>
<table height="100%" cellspacing="0" cellpadding="0" width="100%" border="0">
  <tbody>
  <tr>
        <td width="46" bgcolor="#FF0000">&nbsp;</td>
    <td width="96%" align="left" valign="top">
      <table height="401" cellspacing="0" cellpadding="0" width="100%" border="0">
        <tbody>
        <tr>
          <td width="100%" height="100%" align="center" valign="middle" class="textCopy">
            <div>
                    <table width="90%" border="0" cellspacing="0" cellpadding="0" class="textCopy">
                     
                      <tbody><tr> 
                        <td align="center"><p><a href="http://www.noahweb.net/pilot/" target="_blank"><img src="./实现业务系统中的用户权限管理--实现篇_files/pilotlogo.gif" width="117" height="54" border="0" align="right"></a></p>
                          <p></p><center>
                            <p>&nbsp;</p>
                            <p><strong>实现业务系统中的用户权限管理--实现篇</strong>                          </p>
                            <p align="left"><font size="2"><strong>　　</strong></font>在设计篇中，我们已经为大家阐述了有关权限管理系统的数据库设计，在本篇中，我们将重点放在其实现代码部分。为了让你能够更直接更有效的看到全部动作的代码，我们使用“动作分解列表”的方式来陈述每个动作以及相关资源。</p>
                          <p align="left"><strong>实现权限管理功能的动作</strong></p>
                          <table width="100%" border="1" style="font-size:12px ">
                            <tbody><tr align="center" bgcolor="#CCCCCC">
                              <td><strong>动作分解</strong></td>
                              <td><strong>动作名</strong></td>
                              <td><strong>相关表名</strong></td>
                              <td><strong>操作集类型<br>
                              (S,U,I,D,SQL)</strong></td>
                              <td><strong>表单</strong></td>
                              <td><strong>模组</strong></td>
                              <td><strong>字符资源</strong></td>
                              <td><strong>是否分页？</strong></td>
                              <td><strong>返回提示？</strong></td>
                              <td><strong>权限检测</strong></td>
                            </tr>
                            <tr align="center">
                              <td>权限初始化安装</td>
                              <td><span class="code"><a href="http://docs.noahweb.net/ProjectA/setup.html" target="_blank">setup</a></span></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/msetup.html" target="_blank">setup</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setupok.html" target="_blank">setupok</a></td>
                              <td>否</td>
                              <td>否</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>显示添加管理组界面</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addnewgroup.html" target="_blank">addnewgroup</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addgroup.html" target="_blank">addgroup</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td>无</td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行添加管理员动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addnewgroup_ex.html" target="_blank">addnewgroup_ex</a></td>
                              <td>gorupmanager、gorupmanager、mastergroup</td>
                              <td>S、I、I</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/addok.html" target="_blank">addok</a> <a href="http://docs.noahweb.net/ProjectA/adderror.html" target="_blank"><br>
                              adderror</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示所有管理组列表以执行设置权限动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setgroupinfo.html" target="_blank">setgroupinfo</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                              <a href="http://docs.noahweb.net/ProjectA/list_allgroup.html" target="_blank">list_allgroup</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示设置管理组权限界面</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setgroupinfo_input.html" target="_blank">setgroupinfo_input</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                              <a href="http://docs.noahweb.net/ProjectA/list_allgrouppurview.html" target="_blank">list_allgrouppurview</a> <a href="http://docs.noahweb.net/ProjectA/del_confirm.html" target="_blank"><br>
                              del_confirm</a></p></td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行设置管理组权限动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setgroupinfo_ok.html" target="_blank">setgroupinfo_ex</a></td>
                              <td>actiongroup、action、actiongroup</td>
                              <td>D、S、I</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setgrouppurview.html" target="_blank">setgrouppurview</a> <br>
                                <a href="http://docs.noahweb.net/ProjectA/loginjumpframe.html" target="_blank">loginjumpframe</a></p>
                                  <p></p></td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行删除管理组动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/delgroup_ex.html" target="_blank">delgroup_ex</a></td>
                              <td>groupmaster、actiongroup</td>
                              <td>D、D</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a> <a href="http://docs.noahweb.net/ProjectA/checkpointid.html" target="_blank">checkpointid</a></p></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/list_allgroup.html" target="_blank">list_allgroup</a></p></td>
                              <td>是</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示所有管理组列表以执行查看管理组成员动作</td>
                              <td><span class="code"><a href="http://docs.noahweb.net/ProjectA/viewgroupmaster.html" target="_blank">viewgroupmaster</a></span></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <a href="http://docs.noahweb.net/ProjectA/list_allgroup.html" target="_blank"><br>
                              list_allgroup</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>查看所选择管理组下的所有成员</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/viewmaster.html" target="_blank">viewmaster</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                              <a href="http://docs.noahweb.net/ProjectA/listgroupmaster.html" target="_blank">list_groupmaster</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>显示添加管理员界面</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addnewmaster.html" target="_blank">addnewmaster</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addnewmasterform.html" target="_blank">addnewmaster</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td>无</td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行添加管理员动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/addnewmaster_ok.html" target="_blank">addnewmaster_ex</a></td>
                              <td>master、master、mastergroup</td>
                              <td>S、I、I</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/addok.html" target="_blank">addok</a><br>
                                      <a href="http://docs.noahweb.net/ProjectA/adderror.html" target="_blank">adderror</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示所有管理员列表以执行设置管理员权限动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">setmasterpurview</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                              <a href="http://docs.noahweb.net/ProjectA/list_allmaster.html" target="_blank">list_allmaster</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>查看所选择管理员所在管理组</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview_input.html" target="_blank">setmasterpurview_input</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                              <a href="http://docs.noahweb.net/ProjectA/listmastergroup.html" target="_blank">list_mastergroup</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>执行设置所选管理员权限</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview_ok.html" target="_blank">setmasterpurview_ex</a></td>
                              <td>mastergroup、mastergroup</td>
                              <td>D、I</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                                  <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a> <br>
                                  <a href="http://docs.noahweb.net/ProjectA/loginjumpframe.html" target="_blank">loginjumpframe</a>
                                  <p></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示所有管理员列表以执行设置管理员密码动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpass.html" target="_blank">setmasterpass</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a><br><a href="http://docs.noahweb.net/ProjectA/list_allmaster.html" target="_blank">list_allmaster</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>显示密码修改界面</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpass_input.html" target="_blank">setmasterpass_input</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/masterpassword.html" target="_blank">masterpassword</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td>无</td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>执行修改管理员密码动作</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpass_ok.html" target="_blank">setmasterpass_ex</a></td>
                              <td>master</td>
                              <td>SQL</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                                  <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a>
                              </td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>显示所有管理员列表以执行修改管理员信息动作</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterinfo.html" target="_blank">setmasterinfo</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a><br> <a href="http://docs.noahweb.net/ProjectA/list_allmaster.html" target="_blank">list_allmaster</a></p></td>
                              <td>是</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>显示所选择管理员信息修改界面</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterinfo_input.html" target="_blank">setmasterinfo_input</a></td>
                              <td>master</td>
                              <td>S</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/editmasterinfo.html" target="_blank">editmasterinfo</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/del_confirm.html" target="_blank">del_confirm</a></td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td><p>执行修改管理员信息动作</p></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterinfo_ok.html" target="_blank">setmasterinfo_ex</a></td>
                              <td>master</td>
                              <td>U</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a></td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                                  <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a><br>
                                  <a href="http://docs.noahweb.net/ProjectA/list_allmaster.html" target="_blank">list_allmaster</a>
                                  <p></p></td>
                              <td>是</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行删除管理组动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/delmaster_ex.html" target="_blank">delmaster_ex</a></td>
                              <td>master、actiongroup</td>
                              <td>D、D</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a> <a href="http://docs.noahweb.net/ProjectA/checkpointid.html" target="_blank">checkpointid</a></p></td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/setmasterpurview.html" target="_blank">viewtitle</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/list_allmaster.html" target="_blank">list_allmaster</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行修改当前管理员密码动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmyinfo_ok.html" target="_blank">setmyinfo_ex</a></td>
                              <td>master</td>
                              <td>U</td>
                              <td>无</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示修改当前管理员信息界面</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmyinfo.html" target="_blank">setmyinfo</a></td>
                              <td>master</td>
                              <td>S</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/editmasterinfo.html" target="_blank">editmasterinfo</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>执行修改当前管理员密码动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmypass_ok.html" target="_blank">setmypass_ex</a></td>
                              <td>master</td>
                              <td>SQL</td>
                              <td>无</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/viewtitle.html" target="_blank">viewtitle</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/do_ok.html" target="_blank">do_ok</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>是</td>
                            </tr>
                            <tr align="center">
                              <td>显示修改当前管理员密码界面</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/setmypass.html" target="_blank">setmypass</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/masterpassword.html" target="_blank">masterpassword</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>否</td>
                              <td>否</td>
                              <td>是</td>
                            </tr>
                          </tbody></table>
                          <p align="left"><strong>系统动作</strong></p>
                          <table width="100%" border="1" style="font-size:12px ">
                            <tbody><tr align="center" bgcolor="#CCCCCC">
                              <td><strong>动作分解</strong></td>
                              <td><strong>动作名</strong></td>
                              <td><strong>相关表名</strong></td>
                              <td><strong>操作集类型<br>
                              (S,U,I,D,SQL)</strong></td>
                              <td><strong>表单</strong></td>
                              <td><strong>模组</strong></td>
                              <td><strong>字符资源</strong></td>
                              <td><strong>是否分页？</strong></td>
                              <td><strong>返回提示？</strong></td>
                              <td><strong>权限检测</strong></td>
                            </tr>
                            <tr align="center">
                              <td>当管理员第一次进入管理系统时将使用该动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/first.html" target="_blank">*</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/loginform.html" target="_blank">login</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>否</td>
                              <td>否</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>系统登录动作，管理员登录系时将使用该动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/login.html" target="_blank">login</a></td>
                              <td>master</td>
                              <td>SQL</td>
                              <td>无</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/loginok.html" target="_blank">loginok</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/loginjumpframe.html" target="_blank">loginjumpframe</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/loginerror.html" target="_blank">loginerror</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>显示窗口TITLE信息</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/viewtoolstitle.html" target="_blank">viewtoolstitle</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/managertitle.html" target="_blank">managertitle</a></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>显示左工具条</td>
                              <td><a href="http://www.noahweb.net/mail/2/list_tools" target="_blank">list_tools</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>任务系统（预留）</td>
                              <td>autoviewtask</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                            </tr>
                            <tr align="center">
                              <td>当用户未进行登录而执行动作时会引发该动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/nosession.html" target="_blank">nosession</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/nosessiontext.html" target="_blank">nosession</a><br>
                                      <a href="http://docs.noahweb.net/ProjectA/nosessionjumpframe.html" target="_blank">nosessionjumpframe</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>当用户进行删除操作时未点击确认时会引发该动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/nopointid.html" target="_blank">nopointid</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/nopointidtext.html" target="_blank">nopointid</a></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>当用户试图执行自己没有权限执行的动作时会引发该动作</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/nopurview.html" target="_blank">nopurview</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/nopurviewtext.html" target="_blank">nopurview</a></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                            <tr align="center">
                              <td>退出系统</td>
                              <td><a href="http://docs.noahweb.net/ProjectA/outlogin.html" target="_blank">outlogin</a></td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td>无</td>
                              <td><p><a href="http://docs.noahweb.net/ProjectA/loginout.html" target="_blank">loginout</a> <br>
                                      <a href="http://docs.noahweb.net/ProjectA/nosessionjumpframe.html" target="_blank">nosessionjumpframe</a></p></td>
                              <td>否</td>
                              <td>是</td>
                              <td>否</td>
                            </tr>
                          </tbody></table>
                          <p align="left"><strong>详解模组</strong>：</p>
                          <p align="left">　　1.<strong>setup(数据库初始化、权限设置模组)</strong></p>
                          <p align="left">　　当布署好一个新的系统后，我们可以通过执行一个动作setup来安装数据库和一些初始值，通过执行这个动作系统可以正常运行。因为执行setup这个动作时会调用到一个名称为<a href="http://docs.noahweb.net/ProjectA/msetup.html">setup</a>的模组，这个模组的作用是初始化系统所用到的数据库，并且在系统中设置动作的权限，否则数据库和有权限的动作就没办法执行。下面我们来看一下setup模组的代码，<a href="http://docs.noahweb.net/ProjectA/msetup.html">点击这里查看代码</a>。这里我们把代码拆分开看一下，由于setup模组里有好多类似的代码，所以这里我们只找出不同功能的代码做一下介绍：</p>
                          <p align="left">　　第一段：数据库安装</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m1.gif" width="257" height="29"></p>
                          <p align="left">　　在模组中首先调用了一个datebase_SQL_setup这个数据库操作集，这个数据库操作集用来为系统中的数据库表（根据情况删除或新建）做初始化。</p>
                          <p align="left">　　第二段：添加权限信息</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m2.gif" width="438" height="156"></p>
                          <p align="left">　　代码中调用了action_I_newone这个数据库操作集，在这个操作集中加入权限的名称和它的其它信息。</p>
                          <p align="left">　　第三段：添加一个管理员</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m3.gif" width="441" height="515"></p>
                          <p align="left">　　这部分代码中调用了master_I_newone数据库操作集在数据库中添加了一个管理员的信息，这个信息是可以不写在这里的，可以直接在数据库中添加，但是为了减少不必要的麻烦所以直接在这里添入了一个默认的管理员。</p>
                          <p align="left">　　第四段：添加管理员组</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m4.gif" width="411" height="187"></p>
                          <p align="left">　　通过调用groupmanager_I_newmaster这个数据库操作集新建了一个管理员组，并加入了详细的管理员组信息，可以把新用户加入到此管理员组。</p>
                          <p align="left">　　第五段：添加新的工具分栏</p>
                          <p align="left">　　<img src="./实现业务系统中的用户权限管理--实现篇_files/m5.gif" width="439" height="69"></p>
                          <p align="left">　　通过调用actioncolumn_I_newone数据库操作集在工具栏里加入一个工具栏分栏选项。</p>
                          <p align="left">　　第六段：指定管理组</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m6.gif" width="415" height="215"></p>
                          <p align="left">　　通过调用mastergroup_I_newone数据库操作集把admin这个用户加入到第一个管理组里，使该用户成为第一个管理组的成员。</p>
                          <p align="left">　　最后一段：指定管理组拥有的权限</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/m7.gif" width="453" height="231"></p>
                          <p align="left">　　这段代码首先调用了action_S_all数据库操作集并使用Loop语句列出所有的动作，然后调用actiongroup_I_newone这个数据库操作集，把所有的动作都加入到第一个管理组里，使第一个管理组拥有所有权限。</p>
                          <p align="left">　　这里之所以把数据库的安装和权限的设置都放在模组里面，是为了使用户使用更加方便，不需要再去重新手动建库，以减不在数据库这方面的错误，使系统更加简单流畅。如果其它系统也需要权限这方面的管理，可以把模组稍做修改就可以直接拿来用，这样也体现出代码的重用性。</p>
                          <p align="left">&nbsp;</p>
                          <p align="left"><strong> 　　2.checkuserpurview（检验当前用户能否执行该动作的模组）</strong></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>在权限管理系统中，模组<a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a>得到了反复使用，该模组担负着检测用户权限的任务，在所有需要进行访问权限控制的动作的开始部分都调用了该模组，所以理解该模组的代码也有一定难度。下面，我们来看一看该模组的代码。</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/checkuserpurview.gif" width="443" height="332"></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>我们将整段代码拆分一下，首先看第一段，如下图：</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/checkuserpurview_1.gif" width="328" height="61"></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>判断_SESSION.myloginid的值是否为空，如果为空，在当前页面中执行<a href="http://docs.noahweb.net/ProjectA/nosession.html" target="_blank">nosession</a>这个动作。我们在用户登陆的动作中<a href="http://docs.noahweb.net/ProjectA/login.html" target="_blank">login</a>会为登陆的用户使用myloginid的SESSION变量记录下该用户的ID，因此如果用户是正常登陆并在SESSION有效期内的话，则_SESSION.myloginid的值是不可能为空的。通过此部分代码检测用户是否已经登陆成功并获得合法的访问身份。</p>
                          <p align="left"><font size="2"><strong>　　</strong></font>然后看下面的代码，如下图：</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/checkuserpurview_2.gif" width="436" height="183"></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>调用数据库操作集mastergroup_S_bymasterid，使用逻辑层的Loop，使用当前执行的action以及查询返回的groupid作为条件，调用数据库操作集actiongroup_S_byactionandgroupid进行循环查询，如果查询返回值大于0（零），将局部变量purview的值设置为1。</p>
                          <p align="left"><font size="2"><strong>　　</strong></font>这段代码的重点在于使用的Loop进行循环，由于actiongroup表中记录着用户所处的管理组能够执行的权限，并且一个用户可能同时会属于多个组，因此我们需要去检验用户属于的多个组中是否有对该动作执行的权限，因此，我们使用当前需要执行的动作action以及用户所处的管理组groupid循环查询，当前用户所属于的组中只要有一个组具有执行该动作的执行权限，则该用户就可以执行该动作。</p>
                          <p align="left"><font size="2"><strong>　　</strong></font>最后一部分代码如下图：</p>
                          <p align="left"><img src="./实现业务系统中的用户权限管理--实现篇_files/checkuserpurview_3.gif" width="310" height="62"></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>再次使用判断，如果purview的值不为1的话，则在当前页面执行<a href="http://docs.noahweb.net/ProjectA/nopurview.html" target="_blank">nopurview</a>动作。</p>
                          <p align="left"><font size="2"><strong>　　</strong></font>由于之前的代码中，如果用户拥有执行动作的权限的话，会将局部变量purview的值设置为1，所以这里如果该变量值不为1，就说明了此用户没有执行动作的权限，故执行<a href="http://docs.noahweb.net/ProjectA/nopurview.html" target="_blank">nopurview</a>动作。</p>
                          <p align="left"><strong>总结</strong></p>
                          <p align="left"><font size="2"><strong>　　</strong></font>从设计到实现，权限管理系统的教程到这里就全部结束了。在设计阶段，最重要也是最难理解的是那两张映射表的作用，理解了两张映射表，基本上也就理解了整套数据库的设计。而实现阶段，比较难理解的就是上面说到的模组<a href="http://docs.noahweb.net/ProjectA/checkuserpurview.html" target="_blank">checkuserpurview</a>了。理解该模组，需要联合数据库设计，actiongroup表中记录着用户组可以执行的权限，使用action字段和groupid字段进行查询，返回的数大于1，说明了用户所在的组拥有执行该动作的权限。</p>
                          <p align="left"><strong>附录</strong></p>
                          <blockquote>
                            <p align="left"><a href="http://www.noahweb.net/download/demo/news_mysql.zip" target="_blank">MYSQL版本权限管理系统源码下载</a></p>
                            <p align="left"><a href="http://www.noahweb.net/download/demo/news_sql.zip" target="_blank">MSSQL版本权限管理系统源码下载</a></p>
                          </blockquote>                          <br>
                               <p>
                          </p>
                        <p>&nbsp;</p></center></td>
                      </tr>
                      <tr>
                        <td align="center">&nbsp;</td>
                      </tr>
                    </tbody></table>
                    <span style="FONT-SIZE: 9pt; FONT-FAMILY: 宋体; mso-hansi-font-family: &#39;Times New Roman&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;; mso-ansi-language: ZH-CN; mso-fareast-language: ZH-CN; mso-bidi-language: AR-SA"></span></div></td></tr>
        <tr>
                <td height="100" align="right" valign="top" class="text"> <p><br>
                    <font color="#000000"></font></p><hr size="1"><br>
                    <em><font color="#999999">　　　　　　　　　　　<span class="style2">　</span></font></em> <span class="style2"><font color="#000000" style="font-size:10px"><em>NoahWeb</em></font></span><font color="#000000" style="font-size:10px"><em>因您而精彩！</em></font><font color="#000000" style="font-size:10px"><em></em></font><br>
                    <font color="#999999" style="font-size:10px"><em>　</em></font> 
                  <p></p>
                </td>
        </tr>
        </tbody></table></td></tr></tbody></table></div>


</body></html>